<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤§å­¦è·¯æœºçµçš„é“ ç”²è™¾</title>

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: url("bg.jpg") center / cover no-repeat fixed;
  display: flex;
  justify-content: center;
  align-items: center;
}

.panel {
  background: rgba(255,255,255,0.95);
  width: min(520px, 92vw);
  padding: 30px;
  border-radius: 18px;
  box-shadow: 0 20px 40px rgba(0,0,0,.25);
  text-align: center;
}

.logo {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 22px;
}

.block {
  margin-bottom: 22px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
  color: #374151;
}

.input-wrap {
  position: relative;
}

input {
  width: 100%;
  padding: 12px 42px 12px 12px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  text-align: center;
}

.toggle {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  opacity: .7;
}

.otp {
  font-size: 38px;
  letter-spacing: 6px;
  font-weight: 700;
  color: #ef4444;
  margin: 10px 0;
  transition: transform .2s ease;
}

.otp.flash {
  transform: scale(1.1);
}

.timer {
  font-size: 13px;
  color: #6b7280;
}

.copy-btn {
  margin-top: 10px;
  padding: 10px 18px;
  font-size: 14px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg,#fb7185,#f97316);
  color: #fff;
}

.copy-btn:active {
  transform: scale(.96);
}

@media (max-width: 480px) {
  .panel {
    padding: 22px 16px;
    border-radius: 16px;
  }

  .logo {
    font-size: 20px;
  }

  .otp {
    font-size: 30px;
    letter-spacing: 4px;
  }

  input {
    font-size: 14px;
  }

  .copy-btn {
    width: 100%;
  }
}
</style>
</head>

<body>

<div class="panel">
  <div class="logo">ğŸ¦ å¤§å­¦è·¯æœºçµçš„é“ ç”²è™¾</div>

  <div class="block">
    <label>è¯·è¾“å…¥å¯†é’¥</label>
    <div class="input-wrap">
      <input id="hex" type="password" placeholder="åœ¨æ­¤è¾“å…¥å¯†é’¥">
      <div class="toggle" onclick="toggleKey()">ğŸ‘</div>
    </div>
  </div>

  <div class="block">
    <label>å½“å‰éªŒè¯ç </label>
    <div class="otp" id="otp">--------</div>
    <div class="timer" id="timer">å‰©ä½™æ—¶é—´ï¼š30s</div>
    <button class="copy-btn" onclick="copyOTP()">ä¸€é”®å¤åˆ¶éªŒè¯ç </button>
  </div>
</div>

<script>
function toggleKey() {
  const i = document.getElementById("hex");
  i.type = i.type === "password" ? "text" : "password";
}

function hexToBytes(hex) {
  const out = [];
  for (let i = 0; i < hex.length; i += 2) {
    out.push(parseInt(hex.substr(i, 2), 16));
  }
  return new Uint8Array(out);
}

async function generateOTP(bytes) {
  const step = 30;
  const counter = Math.floor(Date.now() / 1000 / step);
  const buf = new ArrayBuffer(8);
  new DataView(buf).setUint32(4, counter);

  const key = await crypto.subtle.importKey(
    "raw",
    bytes,
    { name: "HMAC", hash: "SHA-1" },
    false,
    ["sign"]
  );

  const hmac = new Uint8Array(await crypto.subtle.sign("HMAC", key, buf));
  const o = hmac[hmac.length - 1] & 0xf;
  const code =
    ((hmac[o] & 0x7f) << 24) |
    ((hmac[o + 1] & 0xff) << 16) |
    ((hmac[o + 2] & 0xff) << 8) |
    (hmac[o + 3] & 0xff);

  return (code % 1e8).toString().padStart(8, "0");
}

async function refresh() {
  const hex = document.getElementById("hex").value.trim();
  if (!/^[0-9a-fA-F]{40}$/.test(hex)) return;

  const otpEl = document.getElementById("otp");
  otpEl.innerText = await generateOTP(hexToBytes(hex));
  otpEl.classList.add("flash");
  setTimeout(() => otpEl.classList.remove("flash"), 200);
}

function copyOTP() {
  navigator.clipboard.writeText(document.getElementById("otp").innerText);
}

setInterval(() => {
  const remain = 30 - Math.floor(Date.now() / 1000) % 30;
  document.getElementById("timer").innerText = `å‰©ä½™æ—¶é—´ï¼š${remain}s`;
  if (remain === 30) refresh();
}, 1000);

document.getElementById("hex").addEventListener("input", refresh);
</script>

</body>
</html>
