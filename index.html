
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">

<!-- æ‰‹æœºè‡ªé€‚é…çš„å…³é”® -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>å¤§å­¦è·¯æœºçµçš„é“ ç”²è™¾</title>

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: url("bg.jpg") center / cover no-repeat fixed;
  display: flex;
  justify-content: center;
  align-items: center;
}

.overlay {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(2px);
}

/* ä¸»é¢æ¿ */
.panel {
  position: relative;
  z-index: 1;
  background: rgba(255, 255, 255, 0.95);
  width: 92%;
  max-width: 520px;
  padding: 26px;
  border-radius: 18px;
  box-shadow: 0 20px 40px rgba(0,0,0,.25);
  text-align: center;
}

/* Logo */
.logo {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 22px;
}

.logo span {
  font-size: 28px;
  margin-right: 6px;
}

/* åŒºå— */
.block {
  margin-bottom: 22px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
  color: #374151;
}

/* è¾“å…¥æ¡† */
input {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  text-align: center;
}

/* OTP æ˜¾ç¤º + åŠ¨ç”» */
.otp {
  font-size: 38px;
  letter-spacing: 6px;
  font-weight: 700;
  color: #ef4444;
  margin: 10px 0;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

.otp.refresh {
  transform: scale(1.15);
  opacity: 0.3;
}

.timer {
  font-size: 13px;
  color: #6b7280;
}

/* æŒ‰é’® */
.copy-btn {
  margin-top: 10px;
  padding: 10px 18px;
  font-size: 14px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  background: linear-gradient(135deg, #fb7185, #f97316);
  color: #fff;
}

.copy-btn:active {
  transform: scale(0.96);
}

.hidden {
  display: none;
}

/* æ‰‹æœºå¾®è°ƒ */
@media (max-width: 480px) {
  .logo {
    font-size: 22px;
  }

  .otp {
    font-size: 32px;
    letter-spacing: 4px;
  }

  button {
    width: 100%;
    font-size: 16px;
  }
}
</style>
</head>

<body>
<div class="overlay"></div>

<div class="panel">
  <div class="logo">
    <span>ğŸ¦</span>å¤§å­¦è·¯æœºçµçš„é“ ç”²è™¾
  </div>

  <div class="block">
    <label>è¯·è¾“å…¥å¯†é’¥</label>
    <input id="hex" type="password" placeholder="åœ¨æ­¤è¾“å…¥å¯†é’¥">
    <button class="copy-btn" onclick="toggleKey()">æ˜¾ç¤º / éšè—å¯†é’¥</button>
  </div>

  <!-- Base32 åå°ä½¿ç”¨ï¼Œä¸æ˜¾ç¤º -->
  <div class="hidden" id="base32"></div>

  <div class="block">
    <label>å½“å‰éªŒè¯ç </label>
    <div class="otp" id="otp">--------</div>
    <div class="timer" id="timer">å‰©ä½™æ—¶é—´ï¼š30s</div>
    <button class="copy-btn" onclick="copyOTP()">ä¸€é”®å¤åˆ¶éªŒè¯ç </button>
  </div>
</div>

<script>
const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";

/* HEX â†’ bytes */
function hexToBytes(hex) {
  const out = [];
  for (let i = 0; i < hex.length; i += 2) {
    out.push(parseInt(hex.substr(i, 2), 16));
  }
  return new Uint8Array(out);
}

/* bytes â†’ Base32ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰ */
function toBase32(bytes) {
  let bits = "", res = "";
  for (const b of bytes) bits += b.toString(2).padStart(8, "0");
  for (let i = 0; i + 5 <= bits.length; i += 5) {
    res += alphabet[parseInt(bits.substr(i, 5), 2)];
  }
  return res.substring(0, 32);
}

/* ç”Ÿæˆ 8 ä½ TOTP */
async function generateOTP(bytes) {
  const step = 30;
  const counter = Math.floor(Date.now() / 1000 / step);
  const buf = new ArrayBuffer(8);
  new DataView(buf).setUint32(4, counter);

  const key = await crypto.subtle.importKey(
    "raw",
    bytes,
    { name: "HMAC", hash: "SHA-1" },
    false,
    ["sign"]
  );

  const hmac = new Uint8Array(await crypto.subtle.sign("HMAC", key, buf));
  const o = hmac[hmac.length - 1] & 0xf;
  const code =
    ((hmac[o] & 0x7f) << 24) |
    ((hmac[o + 1] & 0xff) << 16) |
    ((hmac[o + 2] & 0xff) << 8) |
    (hmac[o + 3] & 0xff);

  return (code % 1e8).toString().padStart(8, "0");
}

/* åˆ·æ–° OTPï¼ˆå¸¦åŠ¨ç”»ï¼‰ */
async function refresh() {
  const hex = document.getElementById("hex").value.trim();
  if (!/^[0-9a-fA-F]{40}$/.test(hex)) return;

  const bytes = hexToBytes(hex);
  document.getElementById("base32").innerText = toBase32(bytes);

  const otpEl = document.getElementById("otp");
  otpEl.classList.add("refresh");
  otpEl.innerText = await generateOTP(bytes);
  setTimeout(() => otpEl.classList.remove("refresh"), 250);
}

/* å¤åˆ¶éªŒè¯ç  */
function copyOTP() {
  navigator.clipboard.writeText(
    document.getElementById("otp").innerText
  );
}

/* æ˜¾ç¤º / éšè—å¯†é’¥ */
function toggleKey() {
  const input = document.getElementById("hex");
  input.type = input.type === "password" ? "text" : "password";
}

/* å®šæ—¶å™¨ */
setInterval(() => {
  const remain = 30 - Math.floor(Date.now() / 1000) % 30;
  document.getElementById("timer").innerText = `å‰©ä½™æ—¶é—´ï¼š${remain}s`;
  if (remain === 30) refresh();
}, 1000);

document.getElementById("hex").addEventListener("input", refresh);
</script>

</body>
</html>
